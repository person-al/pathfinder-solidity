## 2022-08-13

- changed Sibling storage to Jitter storage for algorithmic ease and to give a byte back to value
- changed opacity function to have similar results with decreased cyclomatic complexity
- organized Poem contract with category comments

### Gas usage

```
·---------------------------------------|---------------------------|-------------|-----------------------------·
|         Solc version: 0.8.15          ·  Optimizer enabled: true  ·  Runs: 800  ·  Block limit: 30000000 gas  │
········································|···························|·············|······························
|  Methods                                                                                                      │
·················|······················|·············|·············|·············|···············|··············
|  Contract      ·  Method              ·  Min        ·  Max        ·  Avg        ·  # calls      ·  usd (avg)  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  burn                ·      65362  ·      99535  ·      78126  ·           33  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  initialize          ·          -  ·          -  ·     360567  ·            1  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  mint                ·      79514  ·      96614  ·      86590  ·           58  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  packNode            ·      38866  ·      38926  ·      38903  ·           19  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  setHistoricalInput  ·      29021  ·      29033  ·      29028  ·           23  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  transferFrom        ·      50733  ·      67835  ·      55155  ·           58  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  Deployments                          ·                                         ·  % of limit   ·             │
········································|·············|·············|·············|···············|··············
|  TestablePoem                         ·          -  ·          -  ·    3800833  ·       12.7 %  ·          -  │
·---------------------------------------|-------------|-------------|-------------|---------------|-------------·

```

## 2022-08-13

- added stress test file with new test that runs through smart contract lifecycle multiple times
- added logic to handle edge cases when left or right child was 0

### Gas usage

```
·---------------------------------------|---------------------------|-------------|-----------------------------·
|         Solc version: 0.8.15          ·  Optimizer enabled: true  ·  Runs: 800  ·  Block limit: 30000000 gas  │
········································|···························|·············|······························
|  Methods                                                                                                      │
·················|······················|·············|·············|·············|···············|··············
|  Contract      ·  Method              ·  Min        ·  Max        ·  Avg        ·  # calls      ·  usd (avg)  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  burn                ·      65325  ·      99498  ·      78572  ·           33  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  mint                ·      62414  ·      96614  ·      86295  ·           58  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  packNode            ·      39467  ·      39527  ·      39504  ·           19  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  setHistoricalInput  ·      29041  ·      29053  ·      29048  ·           23  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  transferFrom        ·      45976  ·      67878  ·      54898  ·           73  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  Deployments                          ·                                         ·  % of limit   ·             │
········································|·············|·············|·············|···············|··············
|  TestablePoem                         ·          -  ·          -  ·    3295253  ·         11 %  ·          -  │
·---------------------------------------|-------------|-------------|-------------|---------------|-------------·
```

## 2022-08-09

- Removing PoemStructs implementation and reorganizing PoemPacked code to split between Poem and TestablePoem.
- This means Poem and TestablePoem no longer need to be abstract.
- Initialized Poem with the hardcoded nodes for testnet deploy. TestablePoem can always pack or unpack its own nodes.

### Gas usage

Note that if we compare these gas costs to the previous charts, hardcoding the list of nodes seems to save us some gas (roughly 7% lower deployment costs compared to calling initialize in the PoemPacked constructor).

```
·---------------------------------------|---------------------------|-------------|-----------------------------·
|         Solc version: 0.8.15          ·  Optimizer enabled: true  ·  Runs: 800  ·  Block limit: 30000000 gas  │
········································|···························|·············|······························
|  Methods                                                                                                      │
·················|······················|·············|·············|·············|···············|··············
|  Contract      ·  Method              ·  Min        ·  Max        ·  Avg        ·  # calls      ·  usd (avg)  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  burn                ·      64967  ·      99129  ·      80250  ·           26  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  mint                ·      79514  ·      96614  ·      87226  ·           51  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  packNode            ·      39445  ·      39505  ·      39482  ·           19  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  setHistoricalInput  ·      29019  ·      29031  ·      29026  ·           23  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  TestablePoem  ·  transferFrom        ·      50490  ·      67592  ·      53910  ·           50  ·          -  │
·················|······················|·············|·············|·············|···············|··············
|  Deployments                          ·                                         ·  % of limit   ·             │
········································|·············|·············|·············|···············|··············
|  TestablePoem                         ·          -  ·          -  ·    3787102  ·       12.6 %  ·          -  │
·---------------------------------------|-------------|-------------|-------------|---------------|-------------·
```

## 2022-08-09

- Been modularizing code and adding tests
- It's clear that structs vs. packing only helps in a few key places: storing the node information and initializing. Because with PoemPacked we don't have to initialize, we can hardcode the node values, I think PoemPacked will save significant gas. So at this point I think we can remove the structs code. We have the gas calc below to do comparisons later if needed.

### Gas usage

```
·--------------------------------------|---------------------------|-------------|-----------------------------·
|         Solc version: 0.8.15         ·  Optimizer enabled: true  ·  Runs: 800  ·  Block limit: 30000000 gas  │
·······································|···························|·············|······························
|  Methods                                                                                                     │
················|······················|·············|·············|·············|···············|··············
|  Contract     ·  Method              ·  Min        ·  Max        ·  Avg        ·  # calls      ·  usd (avg)  │
················|······················|·············|·············|·············|···············|··············
|  PoemPacked   ·  burn                ·      93769  ·      99111  ·      97279  ·            6  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemPacked   ·  initialize          ·          -  ·          -  ·     871294  ·            4  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemPacked   ·  mint                ·      79514  ·      96614  ·      89443  ·           31  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemPacked   ·  packNode            ·      39650  ·      56798  ·      55875  ·           19  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemPacked   ·  setHistoricalInput  ·          -  ·          -  ·      29053  ·            3  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemPacked   ·  transferFrom        ·      50449  ·      67537  ·      58993  ·           10  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemStructs  ·  burn                ·      93725  ·     102676  ·     100237  ·            6  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemStructs  ·  initialize          ·          -  ·          -  ·    1455938  ·            4  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemStructs  ·  mint                ·      79491  ·      96591  ·      89420  ·           31  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemStructs  ·  setHistoricalInput  ·          -  ·          -  ·      29031  ·            3  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemStructs  ·  storeNode           ·      49736  ·      86784  ·      80623  ·           19  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  PoemStructs  ·  transferFrom        ·      50471  ·      67559  ·      59015  ·           10  ·          -  │
················|······················|·············|·············|·············|···············|··············
|  Deployments                         ·                                         ·  % of limit   ·             │
·······································|·············|·············|·············|···············|··············
|  PoemPacked                          ·          -  ·          -  ·    3205799  ·       10.7 %  ·          -  │
·······································|·············|·············|·············|···············|··············
|  PoemStructs                         ·          -  ·          -  ·    3212815  ·       10.7 %  ·          -  │
·--------------------------------------|-------------|-------------|-------------|---------------|-------------·
```

## 2022-08-01

- updated PoemStructs.sol:
  - now uses one array instead of an array and a map
  - each Node fits into 1 byte, which should save on storage
- no changes to Poem.sol

### Gas usage

```
·-----------------------------|---------------------------|-------------|-----------------------------·
|    Solc version: 0.8.15     ·  Optimizer enabled: true  ·  Runs: 800  ·  Block limit: 30000000 gas  │
······························|···························|·············|······························
|  Methods                                                                                            │
················|·············|·············|·············|·············|···············|··············
|  Contract     ·  Method     ·  Min        ·  Max        ·  Avg        ·  # calls      ·  usd (avg)  │
················|·············|·············|·············|·············|···············|··············
|  Poem         ·  packNode   ·      37515  ·      56706  ·      54818  ·           19  ·          -  │
················|·············|·············|·············|·············|···············|··············
|  PoemStructs  ·  storeNode  ·      47575  ·      86561  ·      79416  ·           19  ·          -  │
················|·············|·············|·············|·············|···············|··············
|  Deployments                ·                                         ·  % of limit   ·             │
······························|·············|·············|·············|···············|··············
|  Poem                       ·          -  ·          -  ·    1684424  ·        5.6 %  ·          -  │
······························|·············|·············|·············|···············|··············
|  PoemStructs                ·          -  ·          -  ·    1566140  ·        5.2 %  ·          -  │
·-----------------------------|-------------|-------------|-------------|---------------|-------------·
```

## 2022-08-01

Created Poem and PoemStructs contracts. They have roughly the same logic, but PoemStructs uses structs to store the graph and Poem packs the struct info into a byte32.

### Gas usage

```
·-----------------------------|---------------------------|-------------|-----------------------------·
|    Solc version: 0.8.15     ·  Optimizer enabled: true  ·  Runs: 800  ·  Block limit: 30000000 gas  │
······························|···························|·············|······························
|  Methods                    ·               6 gwei/gas                ·       1680.05 usd/eth       │
················|·············|·············|·············|·············|···············|··············
|  Contract     ·  Method     ·  Min        ·  Max        ·  Avg        ·  # calls      ·  usd (avg)  │
················|·············|·············|·············|·············|···············|··············
|  Poem         ·  packNode   ·      35395  ·      54586  ·      52698  ·           19  ·       0.53  │
················|·············|·············|·············|·············|···············|··············
|  PoemStructs  ·  storeNode  ·      61155  ·     133823  ·     120302  ·           20  ·       1.21  │
················|·············|·············|·············|·············|···············|··············
|  Deployments                ·                                         ·  % of limit   ·             │
······························|·············|·············|·············|···············|··············
|  Poem                       ·          -  ·          -  ·    1568503  ·        5.2 %  ·      15.81  │
······························|·············|·············|·············|···············|··············
|  PoemStructs                ·          -  ·          -  ·    1573438  ·        5.2 %  ·      15.86  │
·-----------------------------|-------------|-------------|-------------|---------------|-------------·
```
